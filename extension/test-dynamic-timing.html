<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Dynamic Timing System</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .test-button { background: #007cba; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; }
    .test-button:hover { background: #005a82; }
    #content { background: #f5f5f5; padding: 15px; margin: 10px 0; min-height: 100px; border-radius: 5px; }
    .scenario { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    .info { background: #e8f4fd; padding: 10px; border-radius: 5px; margin: 10px 0; }
    .timing-info { background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>Test Dynamic Timing System</h1>
  
  <div class="info">
    <strong>Dynamic Timing Rules:</strong><br>
    • Minimum 15 seconds before any processing<br>
    • Maximum 1 minute - always process after this<br>
    • Process after 10 seconds of no activity (thought complete)<br>
    • Process immediately on urgent signals (errors, stuck)<br>
    • Process on natural breaks (completion words, context switches)
  </div>

  <div class="timing-info">
    <strong>Watch the console</strong> to see when batches are processed and why!
  </div>

  <div class="scenario">
    <h3>Scenario 1: Slow Thinking (Should wait for natural pause)</h3>
    <button class="test-button" onclick="runSlowThinkingScenario()">Start Slow Thinking</button>
    <p>Simulates typing slowly while thinking - should wait for pauses</p>
  </div>

  <div class="scenario">
    <h3>Scenario 2: Urgent Error (Should process immediately)</h3>
    <button class="test-button" onclick="runUrgentErrorScenario()">Start Urgent Error</button>
    <p>Simulates urgent error signals - should process quickly</p>
  </div>

  <div class="scenario">
    <h3>Scenario 3: Natural Completion (Should process on "done")</h3>
    <button class="test-button" onclick="runCompletionScenario()">Start Completion</button>
    <p>Simulates natural completion - should process when user says "done"</p>
  </div>

  <div class="scenario">
    <h3>Scenario 4: Context Switch (Should process on URL change)</h3>
    <button class="test-button" onclick="runContextSwitchScenario()">Start Context Switch</button>
    <p>Simulates switching between different topics/pages</p>
  </div>

  <button class="test-button" onclick="clearContent()" style="background: #dc3545;">Clear Content</button>

  <div id="content">
    Ready to test dynamic timing...<br>
    <strong>Open DevTools Console to see processing decisions!</strong>
  </div>

  <script>
    let content = document.getElementById('content');
    let counter = 0;
    let currentScenario = null;

    function updateContent(text) {
      content.innerHTML = `<strong>Update ${++counter}:</strong><br>${text}<br><br><em>Time: ${new Date().toLocaleTimeString()}</em>`;
    }

    function clearContent() {
      content.innerHTML = 'Content cleared. Ready for new test...';
      counter = 0;
      if (currentScenario) {
        clearInterval(currentScenario);
        currentScenario = null;
      }
    }

    function runSlowThinkingScenario() {
      clearContent();
      updateContent('Starting slow thinking scenario...');
      
      const thinkingSteps = [
        'I need to figure out this algorithm...',
        'Let me think about this step by step...',
        'Hmm, maybe I should try a different approach...',
        'Actually, let me reconsider the problem...',
        'I think I\'m getting closer to the solution...',
        'Wait, let me double-check my logic here...',
        'Ok, I think I understand it better now...'
      ];
      
      let index = 0;
      function nextStep() {
        if (index < thinkingSteps.length) {
          updateContent(thinkingSteps[index]);
          index++;
          
          // Variable delays to simulate thinking pauses
          const delay = Math.random() * 8000 + 4000; // 4-12 seconds
          currentScenario = setTimeout(nextStep, delay);
        } else {
          updateContent('Slow thinking scenario complete. Should have processed during natural pauses.');
        }
      }
      
      setTimeout(nextStep, 2000);
    }

    function runUrgentErrorScenario() {
      clearContent();
      updateContent('Starting urgent error scenario...');
      
      const urgentMessages = [
        'TypeError: Cannot read property of undefined',
        'I\'m really stuck on this error',
        'This problem is blocking me completely',
        'I need help with this issue right away'
      ];
      
      let index = 0;
      currentScenario = setInterval(() => {
        if (index < urgentMessages.length) {
          updateContent(`URGENT: ${urgentMessages[index]}`);
          index++;
        } else {
          clearInterval(currentScenario);
          updateContent('Urgent error scenario complete. Should have processed quickly!');
        }
      }, 3000); // Quick succession for urgency
    }

    function runCompletionScenario() {
      clearContent();
      updateContent('Starting completion scenario...');
      
      const completionSteps = [
        'Working on this function implementation...',
        'Adding the logic for the calculation...',
        'Testing the function with some values...',
        'Perfect! That works correctly now.',
        'Got it! The solution is complete.',
        'Now moving on to the next part...'
      ];
      
      let index = 0;
      currentScenario = setInterval(() => {
        if (index < completionSteps.length) {
          updateContent(completionSteps[index]);
          index++;
        } else {
          clearInterval(currentScenario);
          updateContent('Completion scenario done. Should have processed after "Perfect!" or "Got it!"');
        }
      }, 4000);
    }

    function runContextSwitchScenario() {
      clearContent();
      updateContent('Starting context switch scenario...');
      
      // Simulate URL changes by updating content with different "contexts"
      const contexts = [
        { topic: 'JavaScript Arrays', url: 'developer.mozilla.org/arrays' },
        { topic: 'CSS Flexbox', url: 'css-tricks.com/flexbox' },
        { topic: 'React Hooks', url: 'reactjs.org/hooks' },
        { topic: 'Node.js APIs', url: 'nodejs.org/api' }
      ];
      
      let index = 0;
      currentScenario = setInterval(() => {
        if (index < contexts.length) {
          const context = contexts[index];
          updateContent(`Now reading about ${context.topic} at ${context.url}`);
          
          // Simulate URL change by updating the page title
          document.title = `Learning: ${context.topic}`;
          
          index++;
        } else {
          clearInterval(currentScenario);
          updateContent('Context switch scenario complete. Should have processed on context changes.');
          document.title = 'Test Dynamic Timing System';
        }
      }, 6000);
    }

    // Auto-start with slow thinking scenario
    setTimeout(() => {
      updateContent('Auto-starting slow thinking test in 3 seconds...');
      setTimeout(runSlowThinkingScenario, 3000);
    }, 1000);
  </script>
</body>
</html>
