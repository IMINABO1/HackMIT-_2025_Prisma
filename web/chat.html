<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat â€¢ Prisma</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Inter Font for better readability -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .athena-nav {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .chat-container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .message-user {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 18px 18px 4px 18px;
    }
    
    .message-bot {
      background: rgba(255, 255, 255, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 18px 18px 18px 4px;
      color: white;
    }
    
    .typing-indicator {
      background: rgba(255, 255, 255, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 18px 18px 18px 4px;
    }
    
    .typing-dots {
      display: inline-flex;
      align-items: center;
      space-x: 2px;
    }
    
    .typing-dots span {
      width: 6px;
      height: 6px;
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }
    
    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes typing {
      0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col">
  <nav class="athena-nav mb-8">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center shadow-lg">
          <span class="text-xl">ðŸ§ </span>
        </div>
        <h1 class="text-xl font-semibold text-white tracking-tight">Prisma</h1>
      </div>
      <div class="flex space-x-1 bg-white/10 rounded-full p-1">
        <a href="index.html" class="px-4 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-full text-sm transition-all duration-200">Dashboard</a>
        <a href="mindmap.html" class="px-4 py-2 text-white/80 hover:text-white hover:bg-white/10 rounded-full text-sm transition-all duration-200">Mind Map</a>
        <a href="chat.html" class="px-4 py-2 bg-white text-purple-700 font-medium rounded-full text-sm transition-all duration-200">Chat</a>
      </div>
    </div>
  </nav>

  <main class="container mx-auto px-6 flex-1 flex flex-col max-h-screen pb-6">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h2 class="text-2xl font-bold text-white mb-1">Chat with Prisma</h2>
        <p class="text-white/80 text-sm">Ask questions about your learning journey</p>
      </div>
      <div class="flex items-center space-x-2 bg-white/10 rounded-full px-3 py-1">
        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
        <span class="text-white/90 text-xs font-medium">AI Online</span>
      </div>
    </div>

    <div id="chatBox" class="chat-container flex-1 overflow-y-auto rounded-2xl p-6 space-y-4 max-h-[calc(100vh-300px)] mb-6">
      <!-- Messages will be added here -->
    </div>

    <form id="chatForm" class="flex gap-3">
      <div class="flex-1 relative">
        <input 
          id="chatInput" 
          class="w-full bg-white/90 border-0 rounded-2xl px-6 py-4 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white shadow-lg backdrop-blur-sm" 
          placeholder="Ask me anything about your studies..." 
          required 
        />
        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
        </div>
      </div>
      <button 
        type="submit"
        class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-6 py-4 rounded-2xl font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
        </svg>
      </button>
    </form>
  </main>

  <script>
    // Simple API helper (inline to avoid module issues)
    async function apiPost(path, body) {
      try {
        const res = await fetch(path, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        if (!res.ok) throw new Error(`POST ${path} failed: ${res.status}`);
        return res.json();
      } catch (err) {
        console.error('API Error:', err);
        throw err;
      }
    }

    const chatBox = document.getElementById('chatBox');
    const form = document.getElementById('chatForm');
    const input = document.getElementById('chatInput');

    function addMessage(text, from) {
      const div = document.createElement('div');
      div.className = `mb-6 ${from === 'user' ? 'flex justify-end' : 'flex justify-start items-start space-x-3'}`;
      
      if (from === 'user') {
        div.innerHTML = `
          <div class="message-user text-white px-6 py-3 max-w-xs lg:max-w-md shadow-lg">
            ${text}
          </div>
        `;
      } else {
        div.innerHTML = `
          <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0 shadow-lg">
            <span class="text-white text-sm">ðŸ¤–</span>
          </div>
          <div class="message-bot text-white px-6 py-3 max-w-xs lg:max-w-md shadow-lg">
            ${text}
          </div>
        `;
      }
      
      chatBox.appendChild(div);
      
      // Smooth scroll animation
      chatBox.scrollTo({
        top: chatBox.scrollHeight,
        behavior: 'smooth'
      });
      
      // Add entrance animation
      div.style.opacity = '0';
      div.style.transform = 'translateY(20px)';
      setTimeout(() => {
        div.style.transition = 'all 0.3s ease-out';
        div.style.opacity = '1';
        div.style.transform = 'translateY(0)';
      }, 50);
    }

    // Add welcome message
    addMessage('Hi! I\'m Prisma, your AI study tutor. I can see your learning map and I\'m here to help you identify specific areas where you\'re struggling and create a targeted plan to improve. What topic are you working on right now, or where do you feel stuck?', 'bot');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;
      
      addMessage(text, 'user');
      input.value = '';
      
      // Show typing indicator
      const typingDiv = document.createElement('div');
      typingDiv.className = 'mb-6 flex justify-start items-start space-x-3';
      typingDiv.innerHTML = `
        <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0 shadow-lg">
          <span class="text-white text-sm">ðŸ¤–</span>
        </div>
        <div class="typing-indicator text-white px-6 py-4 shadow-lg">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      `;
      typingDiv.id = 'typing-indicator';
      chatBox.appendChild(typingDiv);
      chatBox.scrollTo({
        top: chatBox.scrollHeight,
        behavior: 'smooth'
      });
      
      try {
        const res = await apiPost('/api/chat/ask', { query: text, userId: 'demo-user' });
        
        // Remove typing indicator
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
          typingIndicator.remove();
        }
        
        addMessage(res.answer || 'I\'m having trouble processing that right now. Could you try rephrasing your question?', 'bot');
      } catch (err) {
        console.error('Chat error:', err);
        
        // Remove typing indicator
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
          typingIndicator.remove();
        }
        
        // Show helpful fallback when API is down
        addMessage('I\'m having trouble connecting to my AI brain right now. Make sure the backend server is running with your Prisma API key, then try again. In the meantime, what specific topic would you like help with?', 'bot');
      }
    });

  </script>
</body>
</html>
